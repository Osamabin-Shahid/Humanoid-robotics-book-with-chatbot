# Data Model: RAG URL Pipeline

## Overview
Data models for the RAG URL ingestion pipeline based on the key entities identified in the feature specification.

## Core Entities

### Text Chunk
**Definition**: A segment of extracted website content with associated metadata

**Fields**:
- `chunk_id` (str): Unique identifier for the chunk
- `content` (str): The actual text content of the chunk
- `source_url` (str): URL where the content was extracted from
- `section` (str): Section or page identifier within the website
- `sequence_number` (int): Order of the chunk within the document
- `token_count` (int): Number of tokens in the chunk
- `hash` (str): Content hash for change detection (for incremental updates)

**Validation Rules**:
- Content must not be empty
- Source URL must be a valid URL format
- Token count must be positive
- Chunk ID must be unique within the system

### Embedding Vector
**Definition**: A high-dimensional numerical representation of text content generated by Cohere models

**Fields**:
- `vector_id` (str): Unique identifier for the vector (same as chunk_id)
- `vector_data` (list[float]): The embedding vector values
- `model_name` (str): Name of the embedding model used
- `model_version` (str): Version of the embedding model
- `dimension` (int): Number of dimensions in the vector

**Validation Rules**:
- Vector data must match expected dimension for the model
- Model name and version must be valid Cohere model identifiers
- Dimension must match the model specification

### Metadata
**Definition**: Information associated with each embedding including URL, document section, chunk ID, and timestamp

**Fields**:
- `chunk_id` (str): Reference to the associated text chunk
- `source_url` (str): Original URL of the content
- `section` (str): Section identifier within the source
- `created_at` (datetime): Timestamp when the metadata was created
- `updated_at` (datetime): Timestamp when the metadata was last updated
- `content_hash` (str): Hash of the original content for change tracking
- `token_count` (int): Number of tokens in the original chunk

**Validation Rules**:
- All timestamp fields must be in UTC
- Source URL must match the associated text chunk
- Content hash must be consistent with the text chunk

### Crawl Result
**Definition**: The complete set of extracted content from a website including all pages and their associated metadata

**Fields**:
- `crawl_id` (str): Unique identifier for the crawl operation
- `source_url` (str): Root URL that was crawled
- `start_time` (datetime): When the crawl started
- `end_time` (datetime): When the crawl completed
- `status` (str): Status of the crawl (success, partial, failed)
- `pages_processed` (int): Number of pages successfully processed
- `total_chunks` (int): Total number of chunks created
- `error_count` (int): Number of errors encountered during crawl
- `error_details` (list[dict]): Details of any errors encountered

**Validation Rules**:
- End time must be after start time
- Status must be one of: success, partial, failed
- Pages processed and total chunks must be non-negative

### Pipeline Configuration
**Definition**: Settings that control the behavior of the ingestion pipeline including chunk size, overlap, rate limits, and API credentials

**Fields**:
- `chunk_size` (int): Maximum number of tokens per chunk (default: 512)
- `overlap_percentage` (float): Percentage overlap between chunks (default: 0.2)
- `rate_limit_requests` (int): Maximum requests per time period to target websites
- `rate_limit_period` (int): Time period in seconds for rate limiting
- `cohere_model` (str): Cohere model name to use for embeddings
- `qdrant_collection` (str): Name of the Qdrant collection to store vectors
- `timeout_seconds` (int): Timeout for HTTP requests
- `max_retries` (int): Maximum number of retry attempts for failed operations

**Validation Rules**:
- Chunk size must be positive
- Overlap percentage must be between 0 and 1
- Rate limit values must be positive
- Timeout and retries must be positive

## Relationships

- **Text Chunk** → **Embedding Vector**: One-to-one relationship (each chunk has one embedding)
- **Text Chunk** → **Metadata**: One-to-one relationship (each chunk has one metadata record)
- **Crawl Result** → **Text Chunk**: One-to-many relationship (one crawl produces many chunks)
- **Pipeline Configuration** → **Crawl Result**: One-to-many relationship (configuration used for multiple crawls)

## State Transitions

### Crawl Result States
- `pending` → `in_progress` → `success` | `partial` | `failed`
- Transitions based on crawl progress and error conditions

## Indexes
- Text Chunk: Index on `source_url` and `chunk_id`
- Metadata: Index on `chunk_id` and `source_url`
- Embedding Vector: Index on `vector_id`
- Crawl Result: Index on `crawl_id` and `source_url`
- Pipeline Configuration: Index on configuration parameters for performance